sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/f/LayoutType","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType"],function(e,t,o,n,i,a,s,r){"use strict";return e.extend("zdashboard.controller.Files",{onInit:function(){this.oModel=this.getOwnerComponent().getModel();this.setModel(new t({Invoices:[],layout:o.TwoColumnsBeginExpanded,bDeletionEnabled:false,bCopyEnabled:false}),"filesView");this._loadInvoices();this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("files").attachPatternMatched(this._onProductMatched,this);this._oInnerTable=this.byId("InvoiceTable");if(this._oInnerTable){this._oInnerTable.attachEventOnce("updateFinished",this.onTableUpdateFinished,this)}this.getOwnerComponent().getEventBus().subscribe("Invoice","Saved",this._onInvoiceSaved,this)},_loadInvoices:async function(){const e=this.getOwnerComponent().getModel();var t=this.getOwnerComponent().getRouter();try{const t=e.bindList("/Invoice");const o=await t.requestContexts();const n=o.map(e=>e.getObject());this.getView().getModel("filesView").setProperty("/Invoices",n)}catch(e){console.error("Failed to load invoices:",e);sap.m.MessageToast.show("Error loading invoices")}},onSearch:function(e){const t=e.getParameter("query")||e.getParameter("newValue");const o=this.byId("InvoiceTable");const n=o.getBinding("items");if(t){const e=new sap.ui.model.Filter({path:"documentId",operator:sap.ui.model.FilterOperator.Contains,value1:t});n.filter([e])}else{n.filter([])}},onTabSelect:function(e){const t=e.getParameter("key");const o=this.byId("InvoiceTable");const n=o.getBinding("items");let i=[];switch(t){case"pdf":i.push(new sap.ui.model.Filter("statusFlag","EQ","P"));break;case"email":i.push(new sap.ui.model.Filter("statusFlag","EQ","E"));break;case"posted":i.push(new sap.ui.model.Filter("statusFlag","EQ","S"));break;case"error":i.push(new sap.ui.model.Filter("statusFlag","EQ","X"));break}n.filter(i)},_onInvoiceSaved:function(){var e=this.byId("InvoiceSmartTable");if(e){e.rebindTable();var t=e.getTable();if(t){t.removeSelections(true)}}},onTableUpdateFinished:function(e){var t=e.getSource();var o=t.getItems();if(o.length>0){var n=o[0];t.setSelectedItem(n);this.getView().getModel("filesView").setProperty("/bDeletionEnabled",true);this.getView().getModel("filesView").setProperty("/bCopyEnabled",true);this._bindDetail(n.getBindingContext())}},_bindDetail:function(e){var t=this.byId("FilesDetailView");if(t){t.setBindingContext(e)}this.getView().getModel("appView").setProperty("/layout","TwoColumnsMidExpanded")},onListItemPress:function(e){const t=e.getParameter("listItem");const o=t.getBindingContext("filesView");const n=o.getObject();const i=`'${n.ID}'`;const a=this.getOwnerComponent().getModel();const s=this.byId("_IDGenFlexibleColumnLayout1");const r=this.byId("FilesDetailView");r.bindElement({path:`/Invoice(ID=${i})`,parameters:{$expand:"to_InvoiceItem,to_InvoiceLogs,attachments"},model:undefined,events:{dataReceived:function(e){console.log("Invoice details loaded",e)}}});s.setLayout(sap.f.LayoutType.TwoColumnsMidExpanded)},_onProductMatched:function(e){sap.ui.core.BusyIndicator.hide();var t=e.getParameter("arguments").objectId||"0",o=this.byId("InvoiceTable");if(e){var n=this.getModel("appView");n.setProperty("/selectedItem","files");sap.ui.getCore().byId("container-zdashboard---app--_IDGenNavigationList").setSelectedKey(n.getProperty("/selectedItem"))}},onTabSelect:function(e){var t=e.getParameter("key");var o=this.byId("InvoiceSmartTable");var n=o.getTable().getBinding("items");var i=[];switch(t){case"pdf":i.push(new a("mode",s.EQ,"pdf"));break;case"email":i.push(new a("mode",s.EQ,"email"));break;case"posted":i.push(new a("statusFlag",s.EQ,"S"));break;case"error":i.push(new a("statusFlag",s.EQ,"E"));break;case"all":default:break}if(n){n.filter(i,"Application")}},onPressDelete:function(e){var t=this.byId("InvoiceTable")},onSelectionChange:function(e){var t=e.getParameter("selected");this._oInnerTable=this.byId("InvoiceTable");t=this._oInnerTable.getSelectedItems().length>0;var o=this._oInnerTable.getSelectedItems().length===1;var n=this.getView().getModel("filesView").setProperty("/bDeletionEnabled",t);var n=this.getView().getModel("filesView").setProperty("/bCopyEnabled",o)},onPressCopy:function(e){var t=this._oInnerTable.getSelectedItem();var o=t.getBindingContext().getObject();var n=this.getView().getModel(),i=this.getModel("appView");const a=n.createEntry("/Invoice",{properties:{companyCode:o.companyCode,documentDate:new Date,postingDate:new Date,invGrossAmount:o.invGrossAmount,documentCurrency:o.documentCurrency,supInvParty:o.supInvParty,InvoicingParty:o.InvoicingParty,InvoiceNumber:""}});i.setProperty("/layout",sap.f.LayoutType.TwoColumnsBeginExpanded);i.setProperty("/isEditable",true);this.getRouter().navTo("fileDetail",{objectId:"new"});this.getOwnerComponent()._oCreateContext=a},NavigateToInvoiceDetails:function(e){var t=e.getSource().getBindingContext();var o=t.getProperty("documentId");this.getOwnerComponent().getRouter().navTo("InvoiceDetail",{docId:o})},onOpenCreateDialog:function(e){var t=this.getOwnerComponent().getModel("modelV2");var o=this.getModel("appView");var n=t.create("/Invoice",{companyCode:"",fiscalYear:""});o.setProperty("/layout","TwoColumnsMidExpanded");o.setProperty("/isFullPage",false);o.setProperty("/isEditable",true);this.getRouter().navTo("fileDetail",{objectId:"new"},false);t._oCreateContext=n;console.log(o.getProperty("/layout"))},formatDate:function(e){if(!e)return null;try{const t=new Date(e);return t.toISOString().split("T")[0]}catch(t){console.warn("Invalid date:",e);return null}},onOpenCreateDialogV41:async function(){const e=this.getView().getModel();const t=e=>e.toISOString().split("T")[0];try{var o=await e.bindList("/Invoice");const t=o.create({companyCode:"",fiscalYear:"",documentDate:this.formatDate(new Date),postingDate:this.formatDate(new Date),invGrossAmount:0,supInvParty:"",InvoicingParty:""});this.getOwnerComponent()._oCreateContext=t;const n=this.getOwnerComponent().getRouter();const i=this.getModel("appView");i.setProperty("/layout",sap.f.LayoutType.TwoColumnsMidExpanded);n.navTo("fileDetail",{objectId:"new"});const a=this.byId("FilesDetailView");a.setBindingContext(t);i.setProperty("/isEditable",true);sap.m.MessageToast.show("Draft invoice created successfully")}catch(e){console.error("Error creating draft:",e);sap.m.MessageBox.error("Failed to create draft invoice")}},onOpenCreateDialogV4:async function(){var e=this.getView().getModel();try{var t=e.bindList("/Invoice");var o=t.create({companyCode:"123",fiscalYear:"100",documentDate:new Date});var n=await o.created();console.log("Created Invoice:",n);this.getView().bindElement({path:o.getPath(),parameters:{expand:"to_InvoiceItem,to_InvoiceLogs,attachments"}});var i=this.getModel("appView");i.setProperty("/layout",sap.f.LayoutType.TwoColumnsMidExpanded);i.setProperty("/isEditable",true);sap.m.MessageToast.show("Draft invoice created successfully")}catch(e){console.error("Error creating draft:",e);sap.m.MessageBox.error("Failed to create draft invoice")}},onCloseCreateDialog:function(e){var t=this.byId("idFilesCreateDialog");if(t)t.close();this.getModel().resetChanges()},onCreate:function(e){this.getModel().submitChanges()},onDelete:function(e){var t=e.getParameter("listItem").getBindingContextPath();this.getModel().remove(t,{groupId:"deleteFile",success:function(e){var t=this.getRouter().getHashChanger().getHash();var o=this.getRouter().getRouteInfoByHash(t).arguments.objectId;if(e.includes(o))this.getRouter().navTo("files");i.show("Arquivo exclu√≠do com sucesso")}.bind(this,t)});var o=e.getParameter("listItem").getDeleteControl();this.openFragment("zdashboard.view.ConfirmationPopover",{id:"idConfirmationPopover",openBy:o,title:"Tem certeza que deseja excluir?"})},onConfirm:function(e){this.getModel().submitChanges({groupId:"deleteFile"});this.byId("idConfirmationPopover").close();return},onCloseDeleteConfirmation:function(e){this.getModel().resetChanges()},onNavBack:function(){history.go(-1)}})});
//# sourceMappingURL=Files.controller.js.map
sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/f/LayoutType","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType"],function(e,t,o,i,s,n,a,r){"use strict";return e.extend("zdashboard.controller.Files",{onInit:function(){this.oModel=this.getOwnerComponent().getModel();this._OriginalDataLocalJSON;this._firstTime=true;this.setModel(new t({Invoices:[],layout:o.TwoColumnsBeginExpanded,bDeletionEnabled:false,bCopyEnabled:false}),"filesView");this._loadInvoices();this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("files").attachPatternMatched(this._onProductMatched,this);this._oInnerTable=this.byId("InvoiceTable");this._oLastSelectedItem=null;this.getOwnerComponent().getEventBus().subscribe("Invoice","Saved",this._onInvoiceSaved,this);sap.ui.getCore().getEventBus().subscribe("InvoiceChannel","ReloadList",this._loadInvoices,this)},_loadInvoices:async function(){const e=this.getOwnerComponent().getModel("modelV2");var t=this.getOwnerComponent().getRouter();try{var o=this;e.read("/Invoice",{success:function(e){o.getView().getModel("filesView").setProperty("/Invoices",e.results)}.bind(this),error:function(e){}})}catch(e){console.error("Failed to load invoices:",e);sap.m.MessageToast.show("Error loading invoices")}},onSearch:function(e){const t=e.getParameter("query")||e.getParameter("newValue");const o=this.byId("InvoiceTable");const i=o.getBinding("items");if(t){const e=new sap.ui.model.Filter({path:"documentId",operator:sap.ui.model.FilterOperator.Contains,value1:t});i.filter([e])}else{i.filter([])}},onTabSelect:function(e){const t=e.getParameter("key");const o=this.byId("InvoiceTable");const i=o.getBinding("items");let s=[];switch(t){case"pdf":s.push(new sap.ui.model.Filter("statusFlag","EQ","P"));break;case"email":s.push(new sap.ui.model.Filter("statusFlag","EQ","E"));break;case"posted":s.push(new sap.ui.model.Filter("statusFlag","EQ","S"));break;case"error":s.push(new sap.ui.model.Filter("statusFlag","EQ","X"));break}i.filter(s)},_onInvoiceSaved:function(){var e=this.byId("InvoiceSmartTable");if(e){e.rebindTable();var t=e.getTable();if(t){t.removeSelections(true)}}},onTableUpdateFinished:function(e){},_bindDetail:function(e){var t=this.byId("FilesDetailView");if(t){t.setBindingContext(e)}this.getView().getModel("appView").setProperty("/layout","OneColumn")},onListItemPress:function(e){sap.ui.core.BusyIndicator.show(0);var t=this.getModel("appView");t.setProperty("/sideBarExpanded",false);var o=this.byId("FilesDetailView");if(o.getModel().hasPendingChanges()){i.warning("You have unsaved changes. Do you want to discard and switch?",{actions:[i.Action.YES,i.Action.NO],onClose:function(s){if(s===i.Action.YES){o.getModel().resetChanges();t.setProperty("/isEditable",false);t.setProperty("/CreateMode",false);const i=e.getParameter("listItem");const s=i.getBindingContext("filesView");const n=s.getObject();const a=n.ID;const r=this.byId("_IDGenFlexibleColumnLayout1");r.setLayout(sap.f.LayoutType.TwoColumnsMidExpanded);this._BindDetailPage(a)}}.bind(this)})}else{t.setProperty("/isEditable",false);t.setProperty("/CreateMode",false);const o=e.getParameter("listItem");const i=o.getBindingContext("filesView");const s=i.getObject();const n=s.ID;const a=this.byId("_IDGenFlexibleColumnLayout1");a.setLayout(sap.f.LayoutType.TwoColumnsMidExpanded);this._BindDetailPage(n)}},_BindDetailPage:function(e){this.getModel("appView").setProperty("/bProcessFlowVisible",true);var t=this.byId("FilesDetailView");var o=t.getModel();var i=`/Invoice(ID=${e},IsActiveEntity=true)`;t.bindElement({path:i,parameters:{expand:"to_InvoiceItem"},events:{dataRequested:function(){sap.ui.core.BusyIndicator.show()},dataReceived:function(){sap.ui.core.BusyIndicator.hide()}}})},_onProductMatched:function(e){sap.ui.core.BusyIndicator.hide();var t=e.getParameter("arguments").objectId||"0",o=this.byId("InvoiceTable");if(e){var i=this.getModel("appView");i.setProperty("/selectedItem","files");sap.ui.getCore().byId("container-zdashboard---app--_IDGenNavigationList").setSelectedKey(i.getProperty("/selectedItem"))}},onPressDelete:function(e){var t=this.byId("InvoiceTable")},onSelectionChange:function(e){var t=this.byId("InvoiceTable");var o=this.getView().getModel("filesView");const i=t.getSelectedItems();const s=i.length;const n=s===1;const a=s>0;o.setProperty("/bCopyEnabled",n);o.setProperty("/bDeletionEnabled",a)},onPressCopy:async function(){const e=this.byId("InvoiceTable");const t=e.getSelectedItems();const o=t[0].getBindingContext("filesView");const i=o.getObject();const s=i.ID;const n=this.getOwnerComponent().getModel("modelV2");sap.ui.core.BusyIndicator.show(0);n.callFunction("/Invoice_copyInvoice",{method:"POST",urlParameters:{ID:`${s}`,IsActiveEntity:true},success:(t,o)=>{sap.ui.core.BusyIndicator.hide(0);sap.m.MessageToast.show("Invoice copied successfully!");const i=e.getBinding("items");i.refresh(true)},error:e=>{sap.ui.core.BusyIndicator.hide(0);console.error(e);sap.m.MessageBox.error("Failed to copy invoice.")}})},onOpenCreateDialog:function(e){var t=this.getModel("appView");t.setProperty("/layout","TwoColumnsMidExpanded");t.setProperty("/CreateMode",true);if(t.getProperty("/isEditable")){s.show("Already in Edit mode")}else{t.setProperty("/isEditable",true);this.getRouter().navTo("fileDetail",{objectId:"new"},false)}},formatDate:function(e){if(!e)return null;try{const t=new Date(e);return t.toISOString().split("T")[0]}catch(t){console.warn("Invalid date:",e);return null}},onCloseCreateDialog:function(e){var t=this.byId("idFilesCreateDialog");if(t)t.close();this.getModel().resetChanges()},onDelete:function(e){var t=e.getParameter("listItem").getBindingContextPath();this.getModel().remove(t,{groupId:"deleteFile",success:function(e){var t=this.getRouter().getHashChanger().getHash();var o=this.getRouter().getRouteInfoByHash(t).arguments.objectId;if(e.includes(o))this.getRouter().navTo("files");s.show("Arquivo exclu√≠do com sucesso")}.bind(this,t)});var o=e.getParameter("listItem").getDeleteControl();this.openFragment("zdashboard.view.ConfirmationPopover",{id:"idConfirmationPopover",openBy:o,title:"Tem certeza que deseja excluir?"})},onConfirm:function(e){this.getModel().submitChanges({groupId:"deleteFile"});this.byId("idConfirmationPopover").close();return},onCloseDeleteConfirmation:function(e){this.getModel().resetChanges()},onNavBack:function(){history.go(-1)}})});
//# sourceMappingURL=Files.controller.js.map
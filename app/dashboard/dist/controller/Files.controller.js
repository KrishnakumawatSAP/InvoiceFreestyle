sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/f/LayoutType","sap/m/MessageBox","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType"],function(e,t,o,i,n,a,s,r){"use strict";return e.extend("zdashboard.controller.Files",{onInit:function(){this.setModel(new t({layout:o.TwoColumnsBeginExpanded,bDeletionEnabled:false,bCopyEnabled:false}),"filesView");this.oRouter=this.getOwnerComponent().getRouter();this.oRouter.getRoute("files").attachPatternMatched(this._onProductMatched,this);this._oInnerTable=this.byId("InvoiceTable");if(this._oInnerTable){this._oInnerTable.attachEventOnce("updateFinished",this.onTableUpdateFinished,this)}},onTableUpdateFinished:function(e){var t=e.getSource();var o=t.getItems();if(o.length>0){var i=o[0];t.setSelectedItem(i);this.getView().getModel("filesView").setProperty("/bDeletionEnabled",true);this.getView().getModel("filesView").setProperty("/bCopyEnabled",true);this._bindDetail(i.getBindingContext())}},_bindDetail:function(e){var t=this.byId("FilesDetailView");if(t){t.setBindingContext(e)}this.getView().getModel("appView").setProperty("/layout","TwoColumnsMidExpanded")},onListItemPress:function(e){var t=e.getParameter("listItem").getBindingContext();this._bindDetail(t);this.getModel("appView").setProperty("/bProcessFlowVisible",true)},_onProductMatched:function(e){sap.ui.core.BusyIndicator.hide();var t=e.getParameter("arguments").objectId||"0",o=this.byId("InvoiceTable")},onTabSelect:function(e){var t=e.getParameter("key");var o=this.byId("InvoiceSmartTable");var i=o.getTable().getBinding("items");var n=[];switch(t){case"pdf":n.push(new a("mode",s.EQ,"pdf"));break;case"email":n.push(new a("mode",s.EQ,"email"));break;case"posted":n.push(new a("statusFlag",s.EQ,"S"));break;case"error":n.push(new a("statusFlag",s.EQ,"E"));break;case"all":default:break}if(i){i.filter(n,"Application")}},onPressDelete:function(e){var t=this.byId("InvoiceTable")},onSelectionChange:function(e){var t=e.getParameter("selected");this._oInnerTable=this.byId("InvoiceTable");t=this._oInnerTable.getSelectedItems().length>0;var o=this._oInnerTable.getSelectedItems().length===1;var i=this.getView().getModel("filesView").setProperty("/bDeletionEnabled",t);var i=this.getView().getModel("filesView").setProperty("/bCopyEnabled",o)},onPressCopy:function(e){var t=this._oInnerTable.getSelectedItem();var o=t.getBindingContext().getObject();var i=this.getView().getModel(),n=this.getModel("appView");const a=i.createEntry("/Invoice",{properties:{CompanyCode:o.CompanyCode,documentDate:new Date,postingDate:new Date,invGrossAmount:o.invGrossAmount,documentCurrency:o.documentCurrency,supInvParty:o.supInvParty,InvoicingParty:o.InvoicingParty,InvoiceNumber:""}});n.setProperty("/layout",sap.f.LayoutType.TwoColumnsBeginExpanded);n.setProperty("/isEditable",true);this.getRouter().navTo("fileDetail",{objectId:"copy"});this.getOwnerComponent()._oCreateContext=a},NavigateToInvoiceDetails:function(e){var t=e.getSource().getBindingContext();var o=t.getProperty("documentId");this.getOwnerComponent().getRouter().navTo("InvoiceDetail",{docId:o})},onOpenCreateDialog:function(e){var t=this.getView().getModel();var o=this.getModel("appView");var i=t.createEntry("/Invoice",{properties:{CompanyCode:"",companyCode:(new Date).getFullYear(),documentDate:new Date,postingDate:new Date,invGrossAmount:0,documentCurrency:"",supInvParty:"",InvoicingParty:""}});this.getModel("appView").setProperty("/layout",sap.f.LayoutType.TwoColumnsBeginExpanded);o.setProperty("/isEditable",true);this.getRouter().navTo("fileDetail",{objectId:"new"},false);this.getOwnerComponent()._oCreateContext=i},onCloseCreateDialog:function(e){var t=this.byId("idFilesCreateDialog");if(t)t.close();this.getModel().resetChanges()},onCreate:function(e){this.getModel().submitChanges()},onDelete:function(e){var t=e.getParameter("listItem").getBindingContextPath();this.getModel().remove(t,{groupId:"deleteFile",success:function(e){var t=this.getRouter().getHashChanger().getHash();var o=this.getRouter().getRouteInfoByHash(t).arguments.objectId;if(e.includes(o))this.getRouter().navTo("files");n.show("Arquivo exclu√≠do com sucesso")}.bind(this,t)});var o=e.getParameter("listItem").getDeleteControl();this.openFragment("zdashboard.view.ConfirmationPopover",{id:"idConfirmationPopover",openBy:o,title:"Tem certeza que deseja excluir?"})},onConfirm:function(e){this.getModel().submitChanges({groupId:"deleteFile"});this.byId("idConfirmationPopover").close();return},onCloseDeleteConfirmation:function(e){this.getModel().resetChanges()},onNavBack:function(){history.go(-1)},onSearch:function(e){var t=e.getParameter("query");var o=new a("Title",s.Contains,t);this.byId("idFilesTable").getBinding("items").filter(o,r.Application)}})});
//# sourceMappingURL=Files.controller.js.map
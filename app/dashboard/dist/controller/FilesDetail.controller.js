sap.ui.define(["./BaseController","sap/f/LayoutType","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/m/MessageToast"],function(e,t,i,s,o){"use strict";return e.extend("zdashboard.controller.FilesDetail",{DELETED_LEVEL:"X",onInit:function(){var e=this.getView();var t=new i({busy:true,delay:0,editable:false,DELETED_LEVEL:this.DELETED_LEVEL,data:[],bProcessFlowVisible:true});this.getRouter().getRoute("fileDetail").attachPatternMatched(this._onObjectMatched,this);var s=this.getView().getBusyIndicatorDelay();this.setModel(t,"filesDetailView");this.getOwnerComponent().getModel().metadataLoaded().then(function(){t.setProperty("/delay",s)});var o={lanes:[{id:"0",icon:"sap-icon://document",label:"Draft",position:0},{id:"1",icon:"sap-icon://approvals",label:"Approval",position:1},{id:"2",icon:"sap-icon://accept",label:"Completed",position:2}],nodes:[{id:"1",lane:"0",title:"Created",titleAbbreviation:"C",state:"Positive",stateText:"Done",children:["2"],texts:["Created by user"],highlighted:false,focused:true},{id:"2",lane:"1",title:"Approval in Progress",titleAbbreviation:"A",state:"Neutral",stateText:"Pending",children:["3"],texts:["Sent for approval"],highlighted:false,focused:false},{id:"3",lane:"2",title:"Completed",titleAbbreviation:"D",state:"Positive",stateText:"Finished",texts:["Approved and closed"],highlighted:false,focused:false}]};var a=new sap.ui.model.json.JSONModel(o);e.setModel(a,"ProcessFlow")},onNavBack:function(){history.go(-1)},onClose:function(e){this.onCancel(e)},onEdit:function(e){this._toggleEdit()},onAddUser:function(e){var t=this.getView().getBindingContext().getPath();var i=this.getModel().getProperty(t+"/Id");var s=this.getModel().createEntry("/FileUsers",{properties:{FileId:i},refreshAfterChange:false,groupId:"changes"});var o=this.byId("idFilesUsersColumnListItem").clone();o.bindElement(s.getPath());this.byId("idFilesUsersTable").addItem(o)},onDeleteUser:function(e){var t=e.getParameter("listItem").getBindingContext().getPath();this.getModel().setProperty(t+"/Level",this.DELETED_LEVEL);this.getModel().remove(t,{groupId:"changes"})},onShowMessages:function(e){var t=e.getSource();this.openFragment("zdashboard.view.MessagePopover",{id:"idMessagePopover",openBy:t})},onCancel:function(e){if(!this.getModel().hasPendingChanges()){this.onConfirm(e);return}var t=e.getSource();this.openFragment("zdashboard.view.ConfirmationPopover",{id:"idConfirmationPopover",openBy:t,title:"As modificações serão perdidas. Deseja continuar?"})},onConfirm:function(e){this.getModel().resetChanges();sap.ui.getCore().getMessageManager().removeAllMessages();var i=this.byId("idConfirmationPopover");var s;if(i){i.close();s=i.getOpenedBy()}this.getModel("appView").setProperty("/isEditable",true);var o=s?s.getId():e.getSource().getId();if(o.includes("idCloseButton")){this.getModel("appView").setProperty("/layout",t.OneColumn);this.getRouter().navTo("files")}},onSave:function(e){var t=this.getView().getModel();var i=this.getModel("appView");var s=this;t.submitChanges({success:function(e){if(!t.hasPendingChanges()){sap.m.MessageToast.show("Invoice updated successfully");i.setProperty("/isEditable",false);s._bHandlingNew=false;delete s.getOwnerComponent()._oCreateContext}},error:function(e){sap.m.MessageBox.error("Error while updating invoice. Please try again.")}})},_onObjectMatched:function(e){sap.ui.core.BusyIndicator.hide();var t=e.getParameter("arguments").objectId;var i=this.getModel("filesDetailView");var s=this.getModel("appView");var o=this.getOwnerComponent();var a=o._oCreateContext;this.getModel("appView").setProperty("/layout",sap.f.LayoutType.TwoColumnsBeginExpanded);if(t==="new"||t==="copy"){this.getModel("appView").setProperty("/bProcessFlowVisible",false);if(!a){this.getRouter().navTo("files");return}this.getView().setBindingContext(a);s.setProperty("/isEditable",true);var n=this.byId("ObjectPageHeader");if(n){n.setObjectTitle("New Invoice")}return}else{this.getModel("appView").setProperty("/bProcessFlowVisible",true)}s.setProperty("/isEditable",false);delete o._oCreateContext;var r=this.getModel().createKey("/Invoice",{DocumentId:t});this.getView().bindElement({path:r,events:{change:this._onBindingChange.bind(this),dataRequested:function(){i.setProperty("/busy",true)},dataReceived:function(){i.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getModel("filesDetailView");var t=this.getView().getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("notFound");return}e.setProperty("/busy",false)},_toggleEdit:function(){var e=this.getModel("appView");var t=!e.getProperty("/isEditable");e.setProperty("/isEditable",t)}})});
//# sourceMappingURL=FilesDetail.controller.js.map
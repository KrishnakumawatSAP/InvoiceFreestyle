sap.ui.define(["./BaseController","sap/f/LayoutType","sap/ui/model/json/JSONModel","sap/m/MessageBox","sap/m/MessageToast"],function(e,t,i,o,s){"use strict";return e.extend("zdashboard.controller.FilesDetail",{DELETED_LEVEL:"X",onInit:function(){var e=new i({busy:true,delay:0,editable:false,DELETED_LEVEL:this.DELETED_LEVEL});this.getRouter().getRoute("fileDetail").attachPatternMatched(this._onObjectMatched,this);var t=this.getView().getBusyIndicatorDelay();this.setModel(e,"filesDetailView");this.getOwnerComponent().getModel().metadataLoaded().then(function(){e.setProperty("/delay",t)})},onNavBack:function(){history.go(-1)},onClose:function(e){this.onCancel(e)},onEdit:function(e){this._toggleEdit()},onAddUser:function(e){var t=this.getView().getBindingContext().getPath();var i=this.getModel().getProperty(t+"/Id");var o=this.getModel().createEntry("/FileUsers",{properties:{FileId:i},refreshAfterChange:false,groupId:"changes"});var s=this.byId("idFilesUsersColumnListItem").clone();s.bindElement(o.getPath());this.byId("idFilesUsersTable").addItem(s)},onDeleteUser:function(e){var t=e.getParameter("listItem").getBindingContext().getPath();this.getModel().setProperty(t+"/Level",this.DELETED_LEVEL);this.getModel().remove(t,{groupId:"changes"})},onShowMessages:function(e){var t=e.getSource();this.openFragment("zdashboard.view.MessagePopover",{id:"idMessagePopover",openBy:t})},onCancel:function(e){if(!this.getModel().hasPendingChanges()){this.onConfirm(e);return}var t=e.getSource();this.openFragment("zdashboard.view.ConfirmationPopover",{id:"idConfirmationPopover",openBy:t,title:"As modificações serão perdidas. Deseja continuar?"})},onConfirm:function(e){this.getModel().resetChanges();sap.ui.getCore().getMessageManager().removeAllMessages();var i=this.byId("idConfirmationPopover");var o;if(i){i.close();o=i.getOpenedBy()}this.getModel("filesDetailView").setProperty("/editable",false);var s=o?o.getId():e.getSource().getId();if(s.includes("idCloseButton")){this.getModel("filesView").setProperty("/layout",t.OneColumn);this.getRouter().navTo("files")}},onSave:function(e){if(!this.isValid("fileUser")){o.error("Verifique os erros e tente novamente");return}this.getModel().setProperty(this.getView().getBindingContext().getPath()+"/ModifiedAt",new Date);this.getModel().submitChanges({success:function(e){if(!this.getModel().hasPendingChanges()){s.show("Atualizado com sucesso");this._toggleEdit()}}.bind(this)})},_onObjectMatched:function(e){var i=e.getParameter("arguments").objectId;var o=i?t.TwoColumnsBeginExpanded:t.OneColumn;this.getModel("filesView").setProperty("/layout",o);this.getModel("filesDetailView").setProperty("/editable",false);if(!i){return}var s=this.getModel().createKey("/Invoice",{Id:i});var n=this.getModel("filesDetailView");this.getView().bindElement({path:s,events:{change:this._onBindingChange.bind(this),dataRequested:function(){n.setProperty("/busy",true)},dataReceived:function(){n.setProperty("/busy",false)}}})},_onBindingChange:function(){var e=this.getModel("filesDetailView");var t=this.getView().getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("notFound");return}e.setProperty("/busy",false)},_toggleEdit:function(){var e=this.getModel("filesDetailView");var t=!e.getProperty("/editable");e.setProperty("/editable",t)}})});
//# sourceMappingURL=FilesDetail.controller.js.map